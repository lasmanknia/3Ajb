<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3A</title>
    <link rel="stylesheet" href="style.css">
    <style>

        /* Add the CSS code here */


        header {
            background-color: rgba(255, 255, 255, 0.265);
            backdrop-filter: blur(5px);
            border: 0.5px solid white;
            color: rgb(216, 206, 206);
            position: fixed;
            z-index: 1;
            right: 0px;
            top: 10px;
            display: flex;
            width: 45vw;
            font-size: 0.9rem;
            padding: 5px;
            border-radius: 10px 0 0 10px;
            justify-content: center;
        }


        body {
            margin-top: 8vh;
            margin-bottom: 20vh;
            background-size: cover;
            z-index: 1;
        }

        #profiles {
            width: 100vw;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }

        .ami {
            color: rgb(255, 255, 255);
            padding: 5px;
            backdrop-filter: blur(5px);
            border-radius: 10px;
            width: 40vw;
            margin: 10px;
            border: 0.5px solid white;
            text-align: center;
            background-color: rgba(255, 255, 255, 0.265);
        }

        h2 {
            margin-bottom: 3px;
        }

        p {
            font-size: 0.8rem;
            margin: 5px 0;
        }

    </style>
</head>

<body>

    <header>
        <p>PerMealCharge</p>
        <span id="headerContent"></span>
    </header>

    <nav>
        <a href="index.html"><ion-icon name="people"></ion-icon></a>
        <a href="meal.html"><ion-icon name="calendar"></ion-icon></a>
        <a href="adddata.html"><ion-icon name="add-circle"></ion-icon></a>
    </nav>

    <main>
        <div id="profiles"></div>
    </main>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {

            function csvToProfiles(csv) {
                var lines = csv.split('\n');
                var profilesHTML = '';

                var names = lines[0].split(',').slice(1, 17);

                for (var i = 0; i < names.length; i++) {
                    var name = names[i].trim();

                    if (name === "") {
                        continue;
                    }

                    var meals = lines[34].split(',').slice(1, 17);
                    var billsRow36 = lines[35].split(',').slice(1, 17);
                    var givenMoneyRow37 = lines[36].split(',').slice(1, 17);
                    var getBackMoneyRow38 = lines[37].split(',').slice(1, 17);

                    var meal = meals[i].trim();
                    var bill = billsRow36[i].trim();
                    var givenMoney = givenMoneyRow37[i].trim();
                    var getBackMoney = getBackMoneyRow38[i].trim();

                    profilesHTML += '<div class="ami">';
                    profilesHTML += '<h2>' + name + '</h2>';
                    profilesHTML += '<p>TotalMeal: ' + meal + '</p>';
                    profilesHTML += '<p>Bill: ' + bill + '</p>';
                    profilesHTML += '<p>GivenMoney: ' + givenMoney + '</p>';
                    profilesHTML += '<p>GetBackMoney: ' + getBackMoney + '</p>';
                    profilesHTML += '</div>';
                }

                return profilesHTML;
            }

            function fetchCSV(url, callback) {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        callback(xhr.responseText);
                    }
                };
                xhr.open('GET', url, true);
                xhr.send();
            }

            function displayGoogleSheetsProfiles() {
                var googleSheetsLink = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRnio7HFTTnP6tQh5DBQOpiKCcGQ9oZJ4goQMnHiHa9A_MwCEQrIWIbp51PW6yWg_XmchzsksZzwKme/pub?output=csv';

                fetchCSV(googleSheetsLink, function (csvData) {
                    var profilesHTML = csvToProfiles(csvData);
                    document.getElementById('profiles').innerHTML = profilesHTML;
                });
            }

            displayGoogleSheetsProfiles();
        });

        document.addEventListener('DOMContentLoaded', function () {

            function getDataFromA40(csv) {
                var lines = csv.split('\n');
                var dataA40 = lines[39].split(',')[0].trim();
                return dataA40;
            }

            function displayDataInHeader(data) {
                document.getElementById('headerContent').innerHTML = '<p>=' + data + '</p>';
            }

            function fetchCSV(url, callback) {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        callback(xhr.responseText);
                    }
                };
                xhr.open('GET', url, true);
                xhr.send();
            }

            function displayDataFromA40() {
                var googleSheetsLink = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRnio7HFTTnP6tQh5DBQOpiKCcGQ9oZJ4goQMnHiHa9A_MwCEQrIWIbp51PW6yWg_XmchzsksZzwKme/pub?output=csv';

                fetchCSV(googleSheetsLink, function (csvData) {
                    var dataA40 = getDataFromA40(csvData);
                    displayDataInHeader(dataA40);
                });
            }

            displayDataFromA40();
        });

    </script>

</body>

</html>
